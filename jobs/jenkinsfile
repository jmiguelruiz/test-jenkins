import groovy.json.JsonSlurperClassic

def jsonParse(def json) {
    new groovy.json.JsonSlurperClassic().parseText(json)
}

node('master') {
  stage('Checkout and set agent'){
     checkout scm
     if (env.BRANCH_NAME == 'main') {
        AGENT_LABEL = "prod"
     } else {
        AGENT_LABEL = "dev"
     }
   }
}

pipeline {
    agent {
       label "${AGENT_LABEL}"
    }
    stages {
        stage('build') {
            steps {
                sh 'node --version'
            }
        }
    }
}
